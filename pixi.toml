[workspace]
name = "m2t2"
version = "1.0.0"
description = "Multi-Task Masked Transformer for Object-centric Pick and Place"
channels = ["conda-forge"]
platforms = ["linux-64"]

[system-requirements]
cuda = "12.1"

[dependencies]
python = "3.10.*"
pip = "*"
gcc = "12.*"
gxx = "12.*"
cuda-toolkit = "12.*"
ninja = "*"
git-lfs = "*"
pytorch-gpu = "*"
torchvision = "*"

# Python dependencies from requirements.txt
fastapi = "*"
h5py = "*"
hydra-core = "*"
matplotlib = "*"
numpy = "<2"
requests = "*"
scikit-learn = "*"
scipy = "*"
tensorboard = "*"
trimesh = "*"
uvicorn = "*"

[pypi-dependencies]
meshcat = "*"

[tasks]
# Install local packages (run after pixi install)
setup = { cmd = "pip install pointnet2_ops/ --no-build-isolation && pip install -e .", env = { CUDA_HOME = "$CONDA_PREFIX", LD_LIBRARY_PATH = "$CONDA_PREFIX/lib:$LD_LIBRARY_PATH" } }

# Download model weights
download-weights = "GIT_LFS_SKIP_SMUDGE=1 git clone https://huggingface.co/wentao-yuan/m2t2 weights && cd weights && git lfs pull && cd .. && echo '1f8354df8e7f7be10c5edc05cba937a4  weights/m2t2.pth' | md5sum -c - || (echo 'ERROR: Checksum verification failed for weights/m2t2.pth' && exit 1)"

# Run demo (starts meshcat server and runs demo)
demo = "./m2t2_demo.sh"

# Run inference server
server = "python m2t2_server.py"
